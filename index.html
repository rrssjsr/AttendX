<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AttendX — NMIMS Attendance Calculator</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NL3VXFQX89"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NL3VXFQX89');
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #F4F3FF;
            --bg-secondary: #EEEEFF;
            --card-pink: #ffb6c1;
            --card-yellow: #FFD6A5;
            --card-mint: #8AF3D0;
            --card-lavender: #DAD8FF;
            --card-peach: #FFD6A5;
            --card-sky: #b8e4ff;
            --card-cream: #fff8e7;
            --accent: #5B5FEF;
            --accent-dark: #4648c7;
            --text-dark: #111827;
            --text-medium: #4a4a6a;
            --border-dark: #1F2937;
            --white: #ffffff;
            --shadow: 4px 4px 0px #1F2937;
            --shadow-sm: 2px 2px 0px #1F2937;
        }

        [data-theme="dark"] {
            --bg-main: #1a1a1a;
            --bg-secondary: #242424;
            --card-pink: #2d2d2d;
            --card-yellow: #2d2d2d;
            --card-mint: #2a2f2d;
            --card-lavender: #2a2a32;
            --card-peach: #2d2a28;
            --card-sky: #282d30;
            --card-cream: #2a2a28;
            --accent: #8b8bf5;
            --accent-dark: #7a7ae0;
            --text-dark: #ececec;
            --text-medium: #a8a8a8;
            --border-dark: #3d3d3d;
            --white: #262626;
            --shadow: none;
            --shadow-sm: none;
        }
        
        [data-theme="dark"] .stat-box.present { background: #1a3329; }
        [data-theme="dark"] .stat-box.absent { background: #332922; }
        [data-theme="dark"] .stat-box.total { background: #262638; }
        [data-theme="dark"] .stat-box.overall { background: var(--accent); }
        [data-theme="dark"] .upload-box { background: #1f2a26; }
        [data-theme="dark"] .instructions { background: #262626; }
        [data-theme="dark"] .student-card { background: #262638; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-main);
            color: var(--text-dark);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 880px;
            margin: 0 auto;
            padding: 32px 20px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-box {
            width: 48px;
            height: 48px;
            background: var(--card-yellow);
            border: 3px solid var(--border-dark);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 900;
            color: var(--text-dark);
            box-shadow: var(--shadow-sm);
        }

        .logo-content {
            display: flex;
            flex-direction: column;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--text-dark);
            letter-spacing: -1px;
            line-height: 1;
        }

        .hero-tagline {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .rotating-word {
            color: var(--accent);
            display: inline-block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* GenZ Animations */
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes progressBounce {
            0% { width: 0%; }
            80% { width: calc(var(--target-width) + 3%); }
            100% { width: var(--target-width); }
        }

        @keyframes floatShape {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, -10px) rotate(5deg); }
            50% { transform: translate(0, -15px) rotate(0deg); }
            75% { transform: translate(-10px, -10px) rotate(-5deg); }
        }

        /* Floating background shapes */
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.15;
            animation: floatShape 8s ease-in-out infinite;
        }

        .shape-1 {
            width: 100px;
            height: 100px;
            background: var(--accent);
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 60px;
            height: 60px;
            background: var(--card-mint);
            top: 60%;
            right: 10%;
            animation-delay: -2s;
        }

        .shape-3 {
            width: 80px;
            height: 80px;
            background: var(--card-yellow);
            bottom: 20%;
            left: 15%;
            animation-delay: -4s;
        }

        .shape-4 {
            width: 50px;
            height: 50px;
            background: var(--card-pink);
            top: 30%;
            right: 20%;
            animation-delay: -6s;
        }

        /* Logo wiggle on hover */
        .logo-box {
            width: 48px;
            height: 48px;
            background: var(--card-yellow);
            border: 3px solid var(--border-dark);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 900;
            color: var(--text-dark);
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s ease;
        }

        .logo:hover .logo-box {
            animation: wiggle 0.5s ease;
        }

        /* Bouncy hover on cards */
        .stat-box {
            background: var(--white);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 6px 8px 0px var(--border-dark);
        }

        /* Gradient animation on overall box */
        .stat-box.overall {
            background: linear-gradient(135deg, var(--accent), #8b8bf5, var(--accent));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            color: white;
        }

        /* Results slide in */
        .results.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }

        .results.active .stat-box {
            animation: bounceIn 0.5s ease-out backwards;
        }

        .results.active .stat-box:nth-child(1) { animation-delay: 0.1s; }
        .results.active .stat-box:nth-child(2) { animation-delay: 0.2s; }
        .results.active .stat-box:nth-child(3) { animation-delay: 0.3s; }
        .results.active .stat-box:nth-child(4) { animation-delay: 0.4s; }

        /* Bouncy progress bar fill */
        .percent-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Upload box hover */
        .upload-box {
            background: var(--card-mint);
            border: 3px dashed var(--border-dark);
            border-radius: 20px;
            padding: 48px 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .upload-box:hover {
            transform: scale(1.02);
            border-style: solid;
            box-shadow: var(--shadow);
        }

        /* Table card hover */
        .table-card {
            background: var(--white);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        /* Mobile card bounce */
        .mobile-card {
            background: var(--white);
            border: 3px solid var(--border-dark);
            border-radius: 14px;
            padding: 16px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .mobile-card:hover {
            transform: translateY(-4px);
        }

        /* Instructions card float */
        .instructions {
            background: var(--card-cream);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            animation: float 4s ease-in-out infinite;
        }

        /* Student card */
        .student-card {
            background: var(--card-lavender);
            border: 3px solid var(--border-dark);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .student-card:hover {
            transform: translateY(-4px);
        }

        @media (max-width: 600px) {
            .hero-tagline {
                font-size: 1.5rem;
            }
        }

        .theme-btn {
            width: 44px;
            height: 44px;
            background: var(--white);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-btn:hover {
            transform: scale(1.05);
            background: var(--bg-secondary);
        }

        /* Instructions */
        .instructions-title {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions-title span {
            background: var(--card-sky);
            padding: 4px 12px;
            border-radius: 20px;
            border: 2px solid var(--border-dark);
            font-size: 0.8rem;
        }

        .steps-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 0.95rem;
            color: var(--text-medium);
            line-height: 1.5;
        }

        .step-num {
            min-width: 28px;
            height: 28px;
            background: var(--card-pink);
            border: 2px solid var(--border-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.85rem;
            color: var(--text-dark);
        }

        .step-item a {
            color: var(--accent);
            font-weight: 700;
            text-decoration: underline;
            text-underline-offset: 3px;
        }

        .step-item a:hover {
            text-decoration: underline;
            text-decoration-thickness: 2px;
        }

        .portal-alert {
            margin-top: 16px;
            background: var(--card-peach);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-badge {
            background: var(--text-dark);
            color: var(--white);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* Upload */
        .upload-box.dragover {
            background: var(--card-yellow);
            transform: scale(1.02);
        }

        .upload-graphic {
            width: 100px;
            height: 100px;
            background: var(--white);
            border: 3px solid var(--border-dark);
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }

        .upload-graphic svg {
            width: 50px;
            height: 50px;
            stroke: var(--text-dark);
        }

        .upload-box h2 {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .upload-box p {
            color: var(--text-medium);
            font-weight: 500;
        }

        .upload-box input {
            display: none;
        }

        .btn-main {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--text-dark);
            color: var(--white);
            border: 3px solid var(--border-dark);
            padding: 14px 28px;
            border-radius: 14px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }

        .btn-main:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--card-pink);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-dark);
        }

        .btn-save {
            background: var(--card-pink);
            color: var(--text-dark);
        }

        /* Loader */
        .loader {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .loader.active {
            display: flex;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-dark);
            border-top-color: var(--card-pink);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader p {
            font-weight: 700;
        }

        /* Results */
        .results {
            display: none;
            margin-top: 24px;
        }

        @keyframes popUp {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .results-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 900;
        }

        .results-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .results-btns .btn-main {
            margin-top: 0;
            padding: 10px 18px;
            font-size: 0.9rem;
        }

        /* Export Content */
        #exportContent {
            background: var(--bg-main);
            padding: 4px;
            border-radius: 24px;
        }

        /* Student Card */
        .student-card-title {
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            opacity: 0.7;
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
        }

        @media (max-width: 600px) {
            .student-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .student-item {
            background: var(--white);
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            padding: 12px;
        }

        .student-label {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-medium);
            margin-bottom: 4px;
        }

        .student-value {
            font-weight: 800;
            font-size: 0.95rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 900;
            font-family: 'Space Mono', monospace;
            color: var(--text-dark);
        }

        .stat-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-dark);
            opacity: 0.8;
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-box {
                padding: 18px 12px;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .stat-label {
                font-size: 0.75rem;
            }
        }

        .stat-box.total { background: var(--card-lavender); }
        .stat-box.present { background: var(--card-mint); }
        .stat-box.absent { background: var(--card-yellow); }

        /* Table Card */
        .table-card-header {
            background: var(--card-peach);
            padding: 16px 20px;
            font-weight: 800;
            font-size: 1rem;
            border-bottom: 3px solid var(--border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .table-tip {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-medium);
            background: var(--white);
            padding: 4px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-dark);
        }

        .table-scroll {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
        }

        th {
            background: var(--bg-secondary);
            font-weight: 800;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-dark);
        }

        tr {
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        tbody tr:hover {
            background: var(--bg-secondary);
        }

        .subject-name {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .mono {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
        }

        .percent-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .percent-bar {
            flex: 1;
            height: 12px;
            background: rgba(0,0,0,0.1);
            border-radius: 6px;
            border: 2px solid var(--border-dark);
            overflow: hidden;
            min-width: 60px;
        }

        .percent-fill {
            height: 100%;
        }

        .percent-fill.good { background: var(--card-mint); }
        .percent-fill.warning { background: var(--card-yellow); }
        .percent-fill.danger { background: var(--card-pink); }

        .percent-text {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 0.85rem;
            min-width: 48px;
            text-align: right;
        }

        /* Mobile Cards */
        .mobile-list {
            display: none;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
        }

        @media (max-width: 600px) {
            .table-scroll { display: none; }
            .mobile-list { display: flex; }
        }

        .mobile-card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .mobile-card-name {
            font-weight: 800;
            font-size: 0.95rem;
            flex: 1;
            padding-right: 10px;
        }

        .mobile-card-percent {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 4px 10px;
            border-radius: 8px;
            border: 2px solid var(--border-dark);
        }

        .mobile-card-percent.good { background: var(--card-mint); }
        .mobile-card-percent.warning { background: var(--card-yellow); }
        .mobile-card-percent.danger { background: var(--card-pink); }

        .mobile-card-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 10px;
        }

        .mobile-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .mobile-stat-label {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            opacity: 0.6;
        }

        .mobile-stat-value {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
        }

        .mobile-card-bar {
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            border: 2px solid var(--border-dark);
            overflow: hidden;
        }

        /* Expandable missed dates */
        .subject-row.has-missed {
            cursor: pointer;
        }

        .subject-row.has-missed:hover {
            background: var(--bg-secondary);
        }

        .expand-icon {
            display: inline-block;
            font-size: 0.7rem;
            margin-right: 6px;
            transition: transform 0.2s ease;
            color: var(--text-medium);
        }

        .expand-icon-placeholder {
            display: inline-block;
            width: 16px;
        }

        .expand-icon.rotated {
            transform: rotate(90deg);
        }

        .missed-row {
            display: none;
        }

        .missed-row.show {
            display: table-row;
        }

        .missed-dates {
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-medium);
            margin: 4px 0;
        }

        .missed-label {
            font-weight: 700;
            color: var(--text-dark);
            margin-right: 8px;
        }

        /* Mobile missed dates */
        .mobile-card.has-missed {
            cursor: pointer;
        }

        .mobile-card .expand-icon {
            margin-right: 4px;
        }

        .mobile-missed-dates {
            display: none;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid var(--border-dark);
            font-size: 0.8rem;
            color: var(--text-medium);
        }

        .mobile-card.expanded .mobile-missed-dates {
            display: block;
        }

        .mobile-card.expanded .expand-icon {
            transform: rotate(90deg);
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            font-weight: 600;
            color: var(--text-medium);
        }

        .footer-heart {
            display: inline-block;
            background: var(--card-pink);
            padding: 2px 8px;
            border-radius: 6px;
            border: 2px solid var(--border-dark);
            margin: 0 4px;
        }

        /* Animations */
        .stat-box {
            animation: bounceIn 0.5s ease backwards;
        }
        .stat-box:nth-child(1) { animation-delay: 0.1s; }
        .stat-box:nth-child(2) { animation-delay: 0.15s; }
        .stat-box:nth-child(3) { animation-delay: 0.2s; }
        .stat-box:nth-child(4) { animation-delay: 0.25s; }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.8); }
            60% { transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-box">X</div>
                <div class="logo-content">
                    <span class="logo-text">AttendX</span>
                </div>
            </div>
            <button class="theme-btn" onclick="toggleTheme()" title="Toggle theme">
                <span id="themeIcon">☀</span>
            </button>
        </header>

        <div class="hero-tagline">
            <span>Attendance. Summarized.</span>
            <span class="rotating-word" id="rotatingWord">Instantly.</span>
        </div>

        <div class="instructions">
            <div class="instructions-title">
                How to get your PDF
                <span>4 steps</span>
            </div>
            <div class="steps-list">
                <div class="step-item">
                    <span class="step-num">1</span>
                    <span>Open <a href="https://sdc-sppap1.svkm.ac.in:50001/irj/portal" target="_blank">NMIMS SAP Portal</a> and login</span>
                </div>
                <div class="step-item">
                    <span class="step-num">2</span>
                    <span>Go to Student Attendance Report, select date range</span>
                </div>
                <div class="step-item">
                    <span class="step-num">3</span>
                    <span>Click Get Report, then download as PDF</span>
                </div>
                <div class="step-item">
                    <span class="step-num">4</span>
                    <span>Upload that PDF here — done!</span>
                </div>
            </div>
            <div class="portal-alert">
                <span class="alert-badge">NOTE</span>
                Portal only works from 6:00 PM to 7:00 AM
            </div>
        </div>

        <div class="upload-box" id="uploadBox">
            <div class="upload-content">
                <div class="upload-graphic">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="12" y1="18" x2="12" y2="12"/>
                        <line x1="9" y1="15" x2="12" y2="12"/>
                        <line x1="15" y1="15" x2="12" y2="12"/>
                    </svg>
                </div>
                <h2>Drop your PDF here</h2>
                <p>or click to select file</p>
                <button class="btn-main">Select PDF</button>
            </div>
            <div class="loader" id="loader">
                <div class="loader-spinner"></div>
                <p>Crunching your numbers...</p>
            </div>
            <input type="file" id="fileInput" accept=".pdf">
        </div>

        <div class="results" id="results">
            <div class="results-top">
                <h2 class="results-title">Your Report</h2>
                <div class="results-btns">
                    <button class="btn-main btn-save" onclick="saveAsImage()">Save as Image</button>
                    <button class="btn-main btn-secondary" onclick="resetAll()">Upload New</button>
                </div>
            </div>

            <div id="exportContent">
                <div class="student-card">
                    <div class="student-card-title">Student Details</div>
                    <div class="student-grid" id="studentGrid"></div>
                </div>

                <div class="stats-grid" id="statsGrid"></div>

                <div class="table-card">
                    <div class="table-card-header">
                        Subject Breakdown
                        <span class="table-tip">Click a row to see missed dates</span>
                    </div>
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Total</th>
                                    <th>Present</th>
                                    <th>Absent</th>
                                    <th>Attendance</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                    <div class="mobile-list" id="mobileList"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            Made with <span class="footer-heart">care</span> for NMIMS students
        </div>
    </div>

    <script>
        // Rotating tagline words
        const rotatingWords = ['Instantly.', 'Conveniently.', 'Effortlessly.', 'Automatically.', 'Seamlessly.', 'Quickly.', 'Easily.', 'Perfectly.', 'Simply.', 'Smoothly.'];
        let wordIndex = 0;
        
        setInterval(() => {
            wordIndex = (wordIndex + 1) % rotatingWords.length;
            const el = document.getElementById('rotatingWord');
            el.style.animation = 'none';
            el.offsetHeight; // Trigger reflow
            el.textContent = rotatingWords[wordIndex];
            el.style.animation = 'fadeInUp 0.5s ease';
        }, 2000);

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Theme
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('attendx-theme', next);
            document.getElementById('themeIcon').textContent = next === 'dark' ? '☾' : '☀';
        }

        // Load saved theme - default to light always
        const savedTheme = localStorage.getItem('attendx-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        if (document.getElementById('themeIcon')) {
            document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '☾' : '☀';
        }

        // Upload handlers
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const loader = document.getElementById('loader');
        const results = document.getElementById('results');

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file?.type === 'application/pdf') processFile(file);
        });

        uploadBox.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) processFile(e.target.files[0]);
        });

        async function processFile(file) {
            document.querySelector('.upload-content').style.display = 'none';
            loader.classList.add('active');

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                // Process each page separately to avoid text joining issues
                let allMatches = [];
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    let pageText = content.items.map(item => item.str).join(' ');
                    
                    // Find table boundaries within this page
                    const startMatch = pageText.search(/Sr\s*No\.?\s+Course\s*Name/i);
                    
                    // If start found, trim from there
                    if (startMatch !== -1) {
                        pageText = pageText.substring(startMatch);
                    }
                    
                    // Now search for end in the trimmed text
                    const endMatch = pageText.search(/P\s*-?\s*Present\s*:\s*A\s*-?\s*Absent/i);
                    if (endMatch !== -1) {
                        pageText = pageText.substring(0, endMatch);
                    }
                    
                    // Universal pattern: [Sr No] [Subject - anything until date] [Date] [Time] [Time] [Status]
                    const pattern = /(\d+)\s+(.+?)\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+(\d{1,2}),\s*(\d{4})\s+(\d{1,2}:\d{2}:\d{2}\s*[AP]M)\s+(\d{1,2}:\d{2}:\d{2}\s*[AP]M)\s+(P|A|AG|L|NU)/gi;
                    
                    let m;
                    while ((m = pattern.exec(pageText)) !== null) {
                        let subj = m[2].trim();
                        const month = m[3];
                        const day = m[4];
                        const year = m[5];
                        const status = m[8].toUpperCase();
                        const dateStr = `${month} ${day}, ${year}`;
                        
                        // Clean subject name - remove course codes
                        subj = subj
                            .replace(/-\d{4}-T\d-[A-Z].*$/i, '')  // BSc style: -7405-T1-A
                            .replace(/[TPU]\d\s+[A-Z].*$/i, '')    // MBA style: T1 MBA...
                            .replace(/\s+/g, ' ')
                            .trim();
                        
                        // Skip garbage entries (page headers/footers)
                        const isGarbage = 
                            subj.includes('Sr N') ||
                            subj.includes('Course N') ||
                            subj.includes('Start Time') ||
                            subj.includes('End Time') ||
                            subj.includes('Attenda nce') ||
                            subj.includes('Student N') ||
                            subj.includes('Academic') ||
                            subj.includes('Program N') ||
                            subj.includes('SVKM') ||
                            subj.includes('NMIMS') ||
                            subj.includes('Mumbai') ||
                            subj.includes('of 8') ||
                            subj.includes('of 7') ||
                            subj.includes('of 6') ||
                            subj.includes('of 5') ||
                            subj.includes('Page') ||
                            subj.includes('BACHELOR') ||
                            subj.includes('SCIE N CE') ||
                            subj.includes('Roll N') ||
                            subj.length > 60;
                        
                        if (!isGarbage && subj.length > 2) {
                            allMatches.push({ subject: subj, status: status, date: dateStr });
                        }
                    }
                }
                
                // Build full text for student info parsing
                let fullText = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    fullText += content.items.map(item => item.str).join(' ') + '\n';
                }

                displayResults(parseData(fullText, allMatches));
                console.log("=== RAW PDF TEXT ===");
                console.log(fullText);
                console.log("=== END ===");
            } catch (err) {
                console.error(err);
                alert('Error reading PDF. Make sure it\'s a valid NMIMS attendance report.');
                resetAll();
            }
        }

        function parseData(text, allMatches) {
            const info = {};
            
            // Text format is: VALUE Label (reversed)
            // e.g., "ANVESHA GOYAL Student Name 74052300385 Student Number"
            
            // Name comes before "Student Name" - but may have junk before it
            const nameMatch = text.match(/([A-Z][A-Z]+\s+[A-Z]+)\s+Student\s+Name/);
            if (nameMatch) {
                let name = nameMatch[1].trim();
                // Remove common junk prefixes
                name = name.replace(/^.*?(NMIMS|SVKM|Mumbai|School|Commerce)\s*/gi, '');
                info.name = name.trim();
            }
            
            // SAP Number comes before "Student Number"
            const numMatch = text.match(/(\d{11,14})\s+Student\s+Number/);
            if (numMatch) info.sapNumber = numMatch[1].trim();
            
            // Roll No comes before "Roll No."
            const rollMatch = text.match(/([A-Z]\d{2,3})\s+Roll\s+No/);
            if (rollMatch) info.roll = rollMatch[1].trim();
            
            // Program comes before "Program Name"
            const progMatch = text.match(/([A-Z][A-Z\s()]+?)\s+Program\s+Name/);
            if (progMatch) info.program = progMatch[1].trim();

            // Academic Year before "Academic Year"
            const yearMatch = text.match(/(\d{4}-\d{4},?\s*Semester\s*[IVX]+)\s+Academic\s+Year/);
            if (yearMatch) info.year = yearMatch[1].trim();

            // Duration - "From X to Y" before "Attendance Report Duration"
            const durMatch = text.match(/From\s+([\d.]+)\s+to\s+([\d.]+)\s+Attendance\s+Report\s+Duration/);
            if (durMatch) info.duration = `${durMatch[1]} to ${durMatch[2]}`;

            // Use pre-extracted matches
            const subjects = {};
            
            // Helper: calculate similarity between two strings (0 to 1)
            function similarity(s1, s2) {
                const longer = s1.length > s2.length ? s1 : s2;
                const shorter = s1.length > s2.length ? s2 : s1;
                if (longer.length === 0) return 1.0;
                
                // Check if one contains the other
                const l1 = s1.toLowerCase().replace(/[^a-z]/g, '');
                const l2 = s2.toLowerCase().replace(/[^a-z]/g, '');
                if (l1.includes(l2) || l2.includes(l1)) return 0.95;
                
                // Levenshtein-based similarity
                const costs = [];
                for (let i = 0; i <= s1.length; i++) {
                    let lastValue = i;
                    for (let j = 0; j <= s2.length; j++) {
                        if (i === 0) costs[j] = j;
                        else if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                    if (i > 0) costs[s2.length] = lastValue;
                }
                return (longer.length - costs[s2.length]) / longer.length;
            }
            
            // Find existing similar subject or return null
            function findSimilar(newSubj) {
                for (const existing of Object.keys(subjects)) {
                    if (similarity(existing, newSubj) > 0.85) {
                        return existing;
                    }
                }
                return null;
            }
            
            for (const match of allMatches) {
                if (match.status === 'NU') continue;
                
                let subj = match.subject;
                
                // Check if similar subject already exists
                const similar = findSimilar(subj);
                if (similar) {
                    // Use the longer (more complete) name
                    if (subj.length > similar.length) {
                        subjects[subj] = subjects[similar];
                        delete subjects[similar];
                    } else {
                        subj = similar;
                    }
                }
                
                if (!subjects[subj]) subjects[subj] = { present: 0, absent: 0, missedDates: [] };
                
                if (['P', 'AG', 'L'].includes(match.status)) subjects[subj].present++;
                else if (match.status === 'A') {
                    subjects[subj].absent++;
                    subjects[subj].missedDates.push(match.date);
                }
            }

            const subjectList = Object.entries(subjects).map(([name, data]) => {
                const total = data.present + data.absent;
                return {
                    name: formatName(name),
                    total,
                    present: data.present,
                    absent: data.absent,
                    percentage: total > 0 ? parseFloat(((data.present / total) * 100).toFixed(1)) : 0,
                    missedDates: data.missedDates || []
                };
            }).sort((a, b) => a.name.localeCompare(b.name));

            return { info, subjects: subjectList };
        }

        function formatName(name) {
            const map = {
                'Mktg of Financial Services': 'Marketing of Financial Services',
                'Fincil Reptg Stds and Anlys II': 'Financial Reporting & Analysis II',
                'Finacil Planning & Welth Mgmt': 'Financial Planning & Wealth Mgmt'
            };
            return map[name] || name;
        }

        function getClass(p) {
            if (p >= 75) return 'good';
            if (p >= 65) return 'warning';
            return 'danger';
        }

        function displayResults(data) {
            // Student info
            const grid = document.getElementById('studentGrid');
            grid.innerHTML = '';
            
            const fields = [
                ['name', 'Name'], ['sapNumber', 'SAP Number'], ['roll', 'Roll No'],
                ['program', 'Program'], ['year', 'Academic Year'], ['duration', 'Duration']
            ];

            fields.forEach(([key, label]) => {
                if (data.info[key]) {
                    grid.innerHTML += `
                        <div class="student-item">
                            <div class="student-label">${label}</div>
                            <div class="student-value">${data.info[key]}</div>
                        </div>
                    `;
                }
            });

            // Stats
            const total = data.subjects.reduce((s, x) => s + x.total, 0);
            const present = data.subjects.reduce((s, x) => s + x.present, 0);
            const absent = data.subjects.reduce((s, x) => s + x.absent, 0);
            const overall = total > 0 ? ((present / total) * 100).toFixed(1) : 0;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-box present">
                    <div class="stat-number">${present}</div>
                    <div class="stat-label">Present</div>
                </div>
                <div class="stat-box absent">
                    <div class="stat-number">${absent}</div>
                    <div class="stat-label">Absent</div>
                </div>
                <div class="stat-box total">
                    <div class="stat-number">${total}</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-box overall">
                    <div class="stat-number">${overall}%</div>
                    <div class="stat-label">Overall</div>
                </div>
            `;

            // Table
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            const mobileList = document.getElementById('mobileList');
            mobileList.innerHTML = '';

            data.subjects.forEach((s, idx) => {
                const cls = getClass(s.percentage);
                const hasMissed = s.missedDates.length > 0;
                const missedId = `missed-${idx}`;
                
                tbody.innerHTML += `
                    <tr class="subject-row ${hasMissed ? 'has-missed' : ''}" onclick="${hasMissed ? `toggleMissed('${missedId}')` : ''}">
                        <td class="subject-name">
                            ${hasMissed ? '<span class="expand-icon">▶</span>' : '<span class="expand-icon-placeholder"></span>'}
                            ${s.name}
                        </td>
                        <td class="mono">${s.total}</td>
                        <td class="mono">${s.present}</td>
                        <td class="mono">${s.absent}</td>
                        <td>
                            <div class="percent-cell">
                                <div class="percent-bar">
                                    <div class="percent-fill ${cls}" style="width:${s.percentage}%"></div>
                                </div>
                                <span class="percent-text">${s.percentage}%</span>
                            </div>
                        </td>
                    </tr>
                    ${hasMissed ? `
                    <tr class="missed-row" id="${missedId}">
                        <td colspan="5">
                            <div class="missed-dates">
                                <span class="missed-label">Missed:</span>
                                ${s.missedDates.join(' • ')}
                            </div>
                        </td>
                    </tr>
                    ` : ''}
                `;

                mobileList.innerHTML += `
                    <div class="mobile-card ${hasMissed ? 'has-missed' : ''}" onclick="${hasMissed ? `toggleMissedMobile(this)` : ''}">
                        <div class="mobile-card-top">
                            <span class="mobile-card-name">
                                ${hasMissed ? '<span class="expand-icon">▶</span>' : ''}
                                ${s.name}
                            </span>
                            <span class="mobile-card-percent ${cls}">${s.percentage}%</span>
                        </div>
                        <div class="mobile-card-stats">
                            <div class="mobile-stat">
                                <span class="mobile-stat-label">Total</span>
                                <span class="mobile-stat-value">${s.total}</span>
                            </div>
                            <div class="mobile-stat">
                                <span class="mobile-stat-label">Present</span>
                                <span class="mobile-stat-value">${s.present}</span>
                            </div>
                            <div class="mobile-stat">
                                <span class="mobile-stat-label">Absent</span>
                                <span class="mobile-stat-value">${s.absent}</span>
                            </div>
                        </div>
                        <div class="mobile-card-bar">
                            <div class="percent-fill ${cls}" style="width:${s.percentage}%"></div>
                        </div>
                        ${hasMissed ? `
                        <div class="mobile-missed-dates">
                            <span class="missed-label">Missed:</span>
                            ${s.missedDates.join(' • ')}
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            uploadBox.style.display = 'none';
            document.querySelector('.instructions').style.display = 'none';
            results.classList.add('active');
        }

        function resetAll() {
            uploadBox.style.display = 'block';
            document.querySelector('.upload-content').style.display = 'block';
            document.querySelector('.instructions').style.display = 'block';
            loader.classList.remove('active');
            results.classList.remove('active');
            fileInput.value = '';
        }

        function toggleMissed(id) {
            const row = document.getElementById(id);
            const prevRow = row.previousElementSibling;
            const icon = prevRow.querySelector('.expand-icon');
            
            row.classList.toggle('show');
            icon.classList.toggle('rotated');
        }

        function toggleMissedMobile(card) {
            card.classList.toggle('expanded');
        }

        async function saveAsImage() {
            const btn = document.querySelector('.btn-save');
            btn.textContent = 'Saving...';
            btn.disabled = true;

            try {
                const el = document.getElementById('exportContent');
                const canvas = await html2canvas(el, {
                    scale: 2,
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--bg-main').trim(),
                    useCORS: true
                });

                const link = document.createElement('a');
                const name = document.querySelector('.student-value')?.textContent || 'Attendance';
                link.download = `AttendX_${name.replace(/\s+/g, '_')}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (err) {
                console.error(err);
                alert('Failed to save image. Try again.');
            } finally {
                btn.textContent = 'Save as Image';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
